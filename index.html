<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"></meta>
    <title>Game</title>
</head>

<body>

    <canvas id="view"></canvas>

    <script src="http://code.jquery.com/jquery-latest.min.js"></script>

    <script src="js/game_object.js"></script>
    <script src="js/block.js"></script>
    <script src="js/guy.js"></script>
    <script src="js/controller.js"></script>

    <!-- Behaviors -->
    <script src="js/behaviors/moving.js"></script>
    <script src="js/behaviors/platform.js"></script>
    <script src="js/behaviors/renderable.js"></script>

    <script>
    var canvas = document.getElementById("view");
    var ctx = canvas.getContext("2d");

    window.requestAnimationFrame(tick);

    var gameState = {objects: []};
    var sprites = [];

    var sprite, block;
/*
    block = createBlock(ctx);
    block.x = 50;
    block.y = 86;
    sprites.push(block);

    block2 = createBlock(ctx);
    block2.x = 100;
    block2.y = 60;
    sprites.push(block2);
*/
    guy = createGuy(ctx);
    guy.x = 50;
    guy.y = 50;
    sprites.push(guy);

    var controller = createController();

    function tick() {
        window.requestAnimationFrame(tick);
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        for (var i = 0; i < sprites.length; i++) {
            sprites[i].tickStart();
        }

        controller.tickStart();

        if (controller.down("left")) {
            guy.hAcceleration = -0.5;
        } else if (controller.down("right")) {
            guy.hAcceleration = 0.5;
        } else {
            guy.hAcceleration = -guy.hSpeed / 5;
        }

        if (controller.pressed("up")) {
            guy.jump();
        }

        if (controller.released("up")) {
            if (guy.vSpeed < 0) {
                guy.vSpeed /= 2;
            }
        }

        //console.log(controller.down("up"));

        for (var i = 0; i < sprites.length; i++) {
            sprites[i].tickEnd(); //@TODO: remove the 'solidObject' argument
        }

        controller.tickEnd();
    };

    </script>
</body>