<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"></meta>
	<title>Game</title>
</head>

<style type="text/css">

body {
	background-color: black;
}

canvas {
	position: absolute;
	background-color: #C5F8FF;
	left: 50%;
	margin-left: -400px;
}

</style>

<body>

	<canvas  width=800 height=600 id="view"></canvas>

	<script src="js/game_controller.js"></script>
	<script src="js/game_state.js"></script>
	<script src="js/controller.js"></script>
	<script src="js/sprite_factory.js"></script>
	<script src="js/sprite.js"></script>
	<script src="js/background.js"></script>
	<script src="js/levels.js"></script>

	<!-- Behaviors -->
	<script src="js/behaviors/behavior.js"></script>
	<script src="js/behaviors/physical.js"></script>
	<script src="js/behaviors/moving.js"></script>
	<script src="js/behaviors/solid.js"></script>
	<script src="js/behaviors/platform.js"></script>
	<script src="js/behaviors/renderable.js"></script>
	<script src="js/behaviors/face_direction.js"></script>

	<!-- Objects -->
	<script src="js/objects/object_factory.js"></script>
	<script src="js/objects/game_object.js"></script>
	<script src="js/camera.js"></script>
	<script src="js/objects/block.js"></script>
	<script src="js/objects/jump_button.js"></script>
	<script src="js/objects/elevator.js"></script>

	<script src="js/objects/characters/character.js"></script>
	<script src="js/objects/characters/giri.js"></script>
	<script src="js/objects/characters/boba.js"></script>
	<script src="js/objects/characters/niri.js"></script>
	<script src="js/objects/characters/majje.js"></script>

	<script>
	var canvas = document.getElementById("view");
	var state = new GameState();
	var camera = new Camera();
	var gameController = new GameController(state, canvas, camera);
	var controlled; // Points to currently controlled object

	state.parseLevel(Levels.level1);
	
	//Här plockar jag bara ut en slumpad rörbar gubbe och börjar styra...
	controlled = state.filter("Moving")[0];
	camera.target = controlled;

	controller = createController();
	state.addObject(controller);


	//=====================
	// Handle mouse presses
	//=====================

	document.body.onmousedown = function(event) {

		var x = camera.x + event.offsetX - canvas.width / 2;
		var y = camera.y + event.offsetY - canvas.height / 2;

		var obj;
		var moving = state.filter("Moving");

		// If a moving object is clicked, start controlling it
		for (var i = 0; i < moving.length; i++) {
			obj = moving[i];
			if (obj.overlapsPoint(x, y)) {
				controlled.hAcceleration = 0;
				controlled.hSpeed = 0;
				controlled = obj;
				return;
			}
		}
		// If no moving object was clicked, a block is created
		block = new ObjectFactory.Block();
		// (Raderna nedanför börjar bli snuskiga...)
		block.x = 32 * Math.round(x / 32);
		block.y = 32 * Math.round(y / 32);

		state.addObject(block);
	};


	//====================
	// Start the game loop
	//====================
	
	gameController.tick();

	</script>
</body>